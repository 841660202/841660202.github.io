---
title: react useState é”™è¯¯ä½¿ç”¨ 
categories: bug
tags: [bug,react]
date: 2022-05-31 10:30:47
---


## Share
```tsx
const Share: FC<ShareProps> = (props) => {
  const { entityType, entityCode } = props

  const [state, setState] = useState<StateProps>({
    value: props.value,
    title: props.title,
    shareId: props.shareId,
    mappingPassword: props.mappingPassword,
    passwordEnable: props.passwordEnable,
    mappingState: props.mappingState,
    expireTime: props.expireTime,
    shortCode: props.shortCode,
  })


  const { value } = state

  ...

  return (
    <div>
      {renderBtn}
      <ShareModal
        entityType={entityType}
        entityCode={entityCode}
        {...modalProps}
        state={state}
        setState={setState}
      />
    </div>
  )
}

export default Share


```
## ShareModal
```tsx

interface ShareModalProps extends ModalFuncProps {
  entityType: EntityType
  entityCode: string
  className?: string
  state: StateProps
  setState: (state: StateProps) => void
}

const Copy = ({ text, children }: { text: string; children: string }) => {
  return (
    <CopyToClipboard
      text={text}
      onCopy={() => {
        message.success('é“¾æ¥å·²å¤åˆ¶')
      }}
    >
      <span>{children}</span>
    </CopyToClipboard>
  )
}

const ShareModal: FC<ShareModalProps> = (props) => {
  const [form] = HookForm.useForm()

  const { state, setState, entityType, entityCode, ...restProps } = props

  const { value, title, mappingPassword, shortCode, expireTime } = state

  const {
    onChange: toggle,
    resetPassword: reset,
    update,
  } = useShare({
    entityCode,
    entityType,
    state,
    setState,
  })


  ....

  return (
    <Modal
      {...restProps}
      className={styles['share-modal-wrap']}
      title="é“¾æ¥åˆ†äº«"
      destroyOnClose
      width={420}
      footer={null}
    >
      <ConditionComponent isShow={value}>
        ....
        <HookForm form={form} style={{ marginBottom: 10, width: '100%' }} layout="vertical">
          <HookForm.Item noStyle shouldUpdate>
            {() => {
              const { url, mappingPassword, expireTime } = form.getFieldsValue()
              const text = `${url}ï¼ˆå¯†ç ï¼š${mappingPassword}ï¼‰ã€Š${title}ã€‹${moment(
                expireTime,
              ).format('YYYY-MM-DD HH:mm:ss')}è¿‡æœŸ`
              return (
                <HookForm.Item name="url" label="">
                  <Input
                    className={styles['share-copy']}
                    addonAfter={<Copy text={text}>å¤åˆ¶é“¾æ¥å’Œå¯†ç </Copy>}
                    disabled
                  />
                </HookForm.Item>
              )
            }}
          </HookForm.Item>
        </HookForm>
      </ConditionComponent>
    </Modal>
  )
}

export default ShareModal

```

## ç”¨æˆ·åé¦ˆ

ä¸ºä»€ä¹ˆåˆ†äº«çš„é“¾æ¥ä¸è¦åˆ†äº«çš„é“¾æ¥å¯¹ä¸ä¸Šï¼Ÿ

## useCallback

useCallbackå—ä¾èµ–é¡¹çš„å½±å“ï¼Œä¸æ›´æ–°ï¼Œä¹‹å‰æ”¹è¿‡åŒäº‹çš„ä»£ç ï¼Œè¿™æ¬¡æ‰«äº†ä¸€æ ·ï¼Œæ²¡æœ‰callbackï¼Œå°±è¿™é—®é¢˜ä¿®æ”¹å‡ ä¸ªäº†

## useState

- æ‰¾äº†ä¸‹æ•°æ®`ShareModal`ç»„ä»¶,çœ‹åˆ°ä¸¤ä¸ªå…¥å‚`state, setState` ï¼Œæˆ‘è‰¹
- ç»§ç»­å¾€ä¸Šå±‚æ‰¾
```tsx
<ShareModal
  entityType={entityType}
  entityCode={entityCode}
  {...modalProps}
  state={state} // ğŸ˜“
  setState={setState} //ğŸ˜“ 
/>
```
- å†å¾€ä¸Šæ‰¾ï¼ŒuseState å†…éƒ¨åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ•°æ®åˆå§‹åŒ–å®Œæˆä¸å†æ”¹å˜

```tsx

  const [state, setState] = useState<StateProps>({
    value: props.value,
    title: props.title,
    shareId: props.shareId,
    mappingPassword: props.mappingPassword,
    passwordEnable: props.passwordEnable,
    mappingState: props.mappingState,
    expireTime: props.expireTime,
    shortCode: props.shortCode,
  })


  const { value } = state

```
- è¿™é‡Œä»£ç è¿™ä¹ˆå†™ï¼Œå…¶ä»–åœ°æ–¹è‚¯å®šä¹Ÿæœ‰è¿™æ ·çš„å†™æ³•ï¼ŒğŸ˜“

## æ”¹ä¸€ä¸‹
```tsx
  const [state, setState] = useState<StateProps>({})


  useEffect(() => {
    setState({ ...props })
  }, [props.shareId])
```
