{"title":"浏览器首屏优化-首屏时间获取","uid":"b4153b96463af3b17371df43a1c660ca","slug":"2022-05-12performance","date":"2022-05-12T10:27:05.000Z","updated":"2022-06-05T05:45:02.882Z","comments":true,"path":"api/articles/2022-05-12performance.json","keywords":null,"cover":[],"content":"<h2 id=\"优化的指标\"><a href=\"#优化的指标\" class=\"headerlink\" title=\"优化的指标\"></a>优化的指标</h2><p>白屏时间 &#x3D; 地址栏输入网址后回车 - 浏览器出现第一个元素<br>首屏时间 &#x3D; 地址栏输入网址后回车 - 浏览器第一屏渲染完成</p>\n<p>影响白屏时间的因素：网络，服务端性能，前端页面结构设计。<br>影响首屏时间的因素：白屏时间，资源下载执行时间。</p>\n<p>通常在 head 解析完，body 开始渲染此时是白屏结束<br>白屏时间 &#x3D; firstPaint - performance.timing.navigationStart || pageStartTime</p>\n<h2 id=\"常用方法\"><a href=\"#常用方法\" class=\"headerlink\" title=\"常用方法\"></a>常用方法</h2><ol>\n<li>首屏模块标签标记， 你觉得首屏完成的地方插入脚本</li>\n<li>同级首屏内加载最慢的图片&#x2F;iframe</li>\n</ol>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9sejV6LmNvbS9hc3NldHMvaW1nL3BlcmZvcm1hbmNlLnBuZw?x-oss-process=image/format,png\"></p>\n<h2 id=\"加载阶段\"><a href=\"#加载阶段\" class=\"headerlink\" title=\"加载阶段\"></a>加载阶段</h2><p>左边红线代表的是网络传输层面的过程，右边红线代表了服务器传输回字节后浏览器的各种事件状态，这个阶段包含了浏览器对文档的解析，DOM 树构建，布局，绘制等等。<br><em>1. prompt for unload</em></p>\n<ul>\n<li>navigationStart: 表示从上一个文档卸载结束时的 unix 时间戳，如果没有上一个文档，这个值将和 fetchStart 相等。<br><em>2. 前一个网页卸载</em></li>\n<li>unloadEventStart: 表示前一个网页（与当前页面同域）unload 的时间戳，如果无前一个网页 unload 或者前一个网页与当前页面不同域，则值为 0。</li>\n<li>unloadEventEnd: 返回前一个页面 unload 时间绑定的回掉函数执行完毕的时间戳。<br><em>3. 重定向</em></li>\n<li>redirectStart: 第一个 HTTP 重定向发生时的时间。有跳转且是同域名内的重定向才算，否则值为 0。</li>\n<li>redirectEnd: 最后一个 HTTP 重定向完成时的时间。有跳转且是同域名内部的重定向才算，否则值为 0。<br><em>4. 使用 HTTP 请求</em></li>\n<li>fetchStart: 浏览器准备好使用 HTTP 请求抓取文档的时间，这发生在检查本地缓存之前。<br><em>5. 域名解析</em></li>\n<li>domainLookupStart&#x2F;domainLookupEnd: DNS 域名查询开始&#x2F;结束的时间，如果使用了本地缓存（即无 DNS 查询）或持久连接，则与 fetchStart 值相等<br><em>6. tcp 链接</em></li>\n<li>connectStart: HTTP（TCP）开始&#x2F;重新 建立连接的时间，如果是持久连接，则与 fetchStart 值相等。</li>\n<li>connectEnd: HTTP（TCP） 完成建立连接的时间（完成握手），如果是持久连接，则与 fetchStart 值相等。<br><em>7. ssl 建立</em></li>\n<li>secureConnectionStart: HTTPS 连接开始的时间，如果不是安全连接，则值为 0。<br><em>8. 读取文档</em></li>\n<li>requestStart: HTTP 请求读取真实文档开始的时间（完成建立连接），包括从本地读取缓存。<br><em>9. 响应</em></li>\n<li>responseStart: HTTP 开始接收响应的时间（获取到第一个字节），包括从本地读取缓存。</li>\n<li>responseEnd: HTTP 响应全部接收完成的时间（获取到最后一个字节），包括从本地读取缓存。<br><em>10. 解析 dom</em></li>\n<li>domLoading: 开始解析渲染 DOM 树的时间，此时 Document.readyState 变为 loading，并将抛出 readystatechange 相关事件。<br><em>11. dom 可交互</em></li>\n<li>domInteractive: 完成解析 DOM 树的时间，Document.readyState 变为 interactive，并将抛出 readystatechange 相关事件，注意只是 DOM 树解析完成，这时候并没有开始加载网页内的资源。<br><em>12. 页面内资源加载</em></li>\n<li>domContentLoadedEventStart: DOM 解析完成后，网页内资源加载开始的时间，在 DOMContentLoaded 事件抛出前发生。</li>\n<li>domContentLoadedEventEnd: DOM 解析完成后，网页内资源加载完成的时间（如 JS 脚本加载执行完毕）。<br><em>13. dom 树解析完成</em></li>\n<li>domComplete: DOM 树解析完成，且资源也准备就绪的时间，Document.readyState 变为 complete，并将抛出 readystatechange 相关事件。<br><em>14. load 事件</em></li>\n<li>loadEventStart: load 事件发送给文档，也即 load 回调函数开始执行的时间。</li>\n<li>loadEventEnd: load 事件的回调函数执行完毕的时间。</li>\n</ul>\n<h2 id=\"Performance-接口\"><a href=\"#Performance-接口\" class=\"headerlink\" title=\"Performance 接口\"></a>Performance 接口</h2><p>Performance 接口可以获取到当前页面与性能相关的信息。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;timeOrigin&quot;: 1652338539312.5,\n  &quot;timing&quot;: &#123;\n    &quot;connectStart&quot;: 1652338539353,\n    &quot;navigationStart&quot;: 1652338539312,\n    &quot;loadEventEnd&quot;: 1652338542492,\n    &quot;domLoading&quot;: 1652338539823,\n    &quot;secureConnectionStart&quot;: 1652338539401,\n    &quot;fetchStart&quot;: 1652338539316,\n    &quot;domContentLoadedEventStart&quot;: 1652338540574,\n    &quot;responseStart&quot;: 1652338539807,\n    &quot;responseEnd&quot;: 1652338539828,\n    &quot;domInteractive&quot;: 1652338540574,\n    &quot;domainLookupEnd&quot;: 1652338539353,\n    &quot;redirectStart&quot;: 0,\n    &quot;requestStart&quot;: 1652338539505,\n    &quot;unloadEventEnd&quot;: 0,\n    &quot;unloadEventStart&quot;: 0,\n    &quot;domComplete&quot;: 1652338542489,\n    &quot;domainLookupStart&quot;: 1652338539353,\n    &quot;loadEventStart&quot;: 1652338542489,\n    &quot;domContentLoadedEventEnd&quot;: 1652338540575,\n    &quot;redirectEnd&quot;: 0,\n    &quot;connectEnd&quot;: 1652338539504\n  &#125;,\n  &quot;navigation&quot;: &#123;\n    &quot;type&quot;: 0,\n    &quot;redirectCount&quot;: 0\n  &#125;\n&#125;</code></pre>\n\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">function getPerfermanceTiming() &#123;\n  let t &#x3D; performance.timing;\n\n  &#x2F;&#x2F; 重定向结束时间 - 重定向开始时间\n  let redirect &#x3D; t.redirectEnd - t.redirectStart;\n  &#x2F;&#x2F; DNS 查询开始时间 - fetech start 时间\n  let appCache &#x3D; t.domainLookupStart - t.fetchStart;\n  &#x2F;&#x2F; DNS 查询结束时间 - DNS 查询开始时间\n  let dns &#x3D; t.domainLookupEnd - t.domainLookupStart;\n  &#x2F;&#x2F; 完成 TCP 连接握手时间 - TCP 连接开始时间\n  let tcp &#x3D; t.connectEnd - t.connectStart;\n  &#x2F;&#x2F; 从请求开始到接收到第一个响应字符的时间\n  let ttfb &#x3D; t.responseStart - t.requestStart;\n  &#x2F;&#x2F; 资源下载时间，响应结束时间 - 响应开始时间\n  let contentDL &#x3D; t.responseEnd - t.responseStart;\n  &#x2F;&#x2F; 从请求开始到响应结束的时间\n  let httpTotal &#x3D; t.responseEnd - t.requestStart;\n  &#x2F;&#x2F; 从页面开始到 domContentLoadedEventEnd\n  let domContentloaded &#x3D; t.domContentLoadedEventEnd - t.navigationStart;\n  &#x2F;&#x2F; 从页面开始到 loadEventEnd\n  let loaded &#x3D; t.loadEventEnd - t.navigationStart;\n\n  let result &#x3D; [\n    &#123; key: &quot;Redirect&quot;, desc: &quot;网页重定向的耗时&quot;, value: redirect &#125;,\n    &#123; key: &quot;AppCache&quot;, desc: &quot;检查本地缓存的耗时&quot;, value: appCache &#125;,\n    &#123; key: &quot;DNS&quot;, desc: &quot;DNS查询的耗时&quot;, value: dns &#125;,\n    &#123; key: &quot;TCP&quot;, desc: &quot;TCP连接的耗时&quot;, value: tcp &#125;,\n    &#123;\n      key: &quot;Waiting(TTFB)&quot;,\n      desc: &quot;从客户端发起请求到接收到响应的时间 &#x2F; Time To First Byte&quot;,\n      value: ttfb,\n    &#125;,\n    &#123;\n      key: &quot;Content Download&quot;,\n      desc: &quot;下载服务端返回数据的时间&quot;,\n      value: contentDL,\n    &#125;,\n    &#123; key: &quot;HTTP Total Time&quot;, desc: &quot;http请求总耗时&quot;, value: httpTotal &#125;,\n    &#123;\n      key: &quot;DOMContentLoaded&quot;,\n      desc: &quot;dom加载完成的时间&quot;,\n      value: domContentloaded,\n    &#125;,\n    &#123; key: &quot;Loaded&quot;, desc: &quot;页面load的总耗时&quot;, value: loaded &#125;,\n  ];\n  return result;\n&#125;\ngetPerfermanceTiming();</code></pre>\n\n<p><a href=\"https://blog.csdn.net/z9061/article/details/101454438\">Web 性能优化-首屏和白屏时间</a></p>\n<h2 id=\"来看下简书\"><a href=\"#来看下简书\" class=\"headerlink\" title=\"来看下简书\"></a>来看下简书</h2><ul>\n<li>链接<ul>\n<li><a href=\"https://www.jianshu.com/p/464593cea4dc\">简书</a></li>\n</ul>\n</li>\n<li>简书代码</li>\n</ul>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">window.addEventListener(&quot;load&quot;, function () &#123;\n  setTimeout(function () &#123;\n    var e &#x3D; window.performance;\n    if (e) &#123;\n      var t &#x3D; e.getEntriesByType(&quot;navigation&quot;)[0],\n        r &#x3D; 0;\n      t || (r &#x3D; (t &#x3D; e.timing).navigationStart);\n      var n &#x3D; [\n        &#123;\n          key: &quot;Redirect&quot;,\n          desc: &quot;\\u7f51\\u9875\\u91cd\\u5b9a\\u5411\\u7684\\u8017\\u65f6&quot;,\n          value: t.redirectEnd - t.redirectStart,\n        &#125;,\n        &#123;\n          key: &quot;AppCache&quot;,\n          desc: &quot;\\u68c0\\u67e5\\u672c\\u5730\\u7f13\\u5b58\\u7684\\u8017\\u65f6&quot;,\n          value: t.domainLookupStart - t.fetchStart,\n        &#125;,\n        &#123;\n          key: &quot;DNS&quot;,\n          desc: &quot;DNS\\u67e5\\u8be2\\u7684\\u8017\\u65f6&quot;,\n          value: t.domainLookupEnd - t.domainLookupStart,\n        &#125;,\n        &#123;\n          key: &quot;TCP&quot;,\n          desc: &quot;TCP\\u8fde\\u63a5\\u7684\\u8017\\u65f6&quot;,\n          value: t.connectEnd - t.connectStart,\n        &#125;,\n        &#123;\n          key: &quot;Waiting(TTFB)&quot;,\n          desc: &quot;\\u4ece\\u5ba2\\u6237\\u7aef\\u53d1\\u8d77\\u8bf7\\u6c42\\u5230\\u63a5\\u6536\\u5230\\u54cd\\u5e94\\u7684\\u65f6\\u95f4 &#x2F; Time To First Byte&quot;,\n          value: t.responseStart - t.requestStart,\n        &#125;,\n        &#123;\n          key: &quot;Content Download&quot;,\n          desc: &quot;\\u4e0b\\u8f7d\\u670d\\u52a1\\u7aef\\u8fd4\\u56de\\u6570\\u636e\\u7684\\u65f6\\u95f4&quot;,\n          value: t.responseEnd - t.responseStart,\n        &#125;,\n        &#123;\n          key: &quot;HTTP Total Time&quot;,\n          desc: &quot;http\\u8bf7\\u6c42\\u603b\\u8017\\u65f6&quot;,\n          value: t.responseEnd - t.requestStart,\n        &#125;,\n        &#123;\n          key: &quot;DOMContentLoaded&quot;,\n          desc: &quot;dom\\u52a0\\u8f7d\\u5b8c\\u6210\\u7684\\u65f6\\u95f4&quot;,\n          value: t.domContentLoadedEventEnd - r,\n        &#125;,\n        &#123;\n          key: &quot;Loaded&quot;,\n          desc: &quot;\\u9875\\u9762load\\u7684\\u603b\\u8017\\u65f6&quot;,\n          value: t.loadEventEnd - r,\n        &#125;,\n      ];\n      if (Math.random() &gt; 0.75) &#123;\n        var s &#x3D; window.location,\n          i &#x3D; s.href,\n          c &#x3D; s.pathname,\n          u &#x3D; navigator.userAgent,\n          d &#x3D; i.split(&quot;?&quot;)[0];\n        o.a\n          .post(&quot;https:&#x2F;&#x2F;tr.jianshu.com&#x2F;fe&#x2F;1&#x2F;mon&#x2F;atf&quot;, &#123;\n            app: &quot;shakespeare-performance&quot;,\n            url: d,\n            ua: u,\n            path: c,\n            stats_ttfb: t.responseStart - t.requestStart,\n            stats_domLoaded: t.domContentLoadedEventEnd - r,\n            stats_loaded: t.loadEventEnd - r,\n          &#125;)\n          .then(a.a)\n          .catch(a.a);\n      &#125;\n      console &amp;&amp; console.log &amp;&amp; console.log(n);\n    &#125;\n  &#125;, 0);\n&#125;);</code></pre>\n\n<h2 id=\"简书截图\"><a href=\"#简书截图\" class=\"headerlink\" title=\"简书截图\"></a>简书截图</h2><p><img src=\"http://t-blog-images.aijs.top/img/20220605112219.webp\"></p>\n<h2 id=\"domContentLoadedEventEnd-与-loaded\"><a href=\"#domContentLoadedEventEnd-与-loaded\" class=\"headerlink\" title=\"domContentLoadedEventEnd 与 loaded\"></a>domContentLoadedEventEnd 与 loaded</h2><pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; 从页面开始到 domContentLoadedEventEnd\nlet domContentloaded &#x3D; t.domContentLoadedEventEnd - t.navigationStart;\n&#x2F;&#x2F; 从页面开始到 loadEventEnd\nlet loaded &#x3D; t.loadEventEnd - t.navigationStart;</code></pre>\n\n<p><strong>domContentLoadedEventEnd 比 loaded 先触发</strong></p>\n<p><img src=\"http://t-blog-images.aijs.top/img/20220605133905.webp\"></p>\n","text":"优化的指标白屏时间 &#x3D; 地址栏输入网址后回车 - 浏览器出现第一个元素首屏时间 &#x3D; 地址栏输入网址后回车 - 浏览器第一屏渲染完成 影响白屏时间的因素：网络，服务端性能，前端页面结构设计。影响首屏时间的因素：白屏时间，资源下载执行时间。 通常在 head 解析...","link":"","photos":[],"count_time":{"symbolsCount":"8.3k","symbolsTime":"8 mins."},"categories":[{"name":"performance","slug":"performance","count":1,"path":"api/categories/performance.json"}],"tags":[{"name":"前端","slug":"前端","count":3,"path":"api/tags/前端.json"},{"name":"performance","slug":"performance","count":1,"path":"api/tags/performance.json"},{"name":"浏览器原理","slug":"浏览器原理","count":2,"path":"api/tags/浏览器原理.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BC%98%E5%8C%96%E7%9A%84%E6%8C%87%E6%A0%87\"><span class=\"toc-text\">优化的指标</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">常用方法</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BD%E9%98%B6%E6%AE%B5\"><span class=\"toc-text\">加载阶段</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Performance-%E6%8E%A5%E5%8F%A3\"><span class=\"toc-text\">Performance 接口</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9D%A5%E7%9C%8B%E4%B8%8B%E7%AE%80%E4%B9%A6\"><span class=\"toc-text\">来看下简书</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%B9%A6%E6%88%AA%E5%9B%BE\"><span class=\"toc-text\">简书截图</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#domContentLoadedEventEnd-%E4%B8%8E-loaded\"><span class=\"toc-text\">domContentLoadedEventEnd 与 loaded</span></a></li></ol>","author":{"name":"陈海龙","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"需要就学呗，多大点事😂","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ModHeader","uid":"f31094f49d8642b9a610a9630bcdbff8","slug":"2022-05-13modeheader","date":"2022-05-13T06:59:19.000Z","updated":"2022-05-13T07:13:27.032Z","comments":true,"path":"api/articles/2022-05-13modeheader.json","keywords":null,"cover":[],"text":"通过不同请求头字段标识请求不同的环境 Requesr HeadersAccept: *&#x2F;* Accept-Encoding: gzip, deflate, br Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,zh-...","link":"","photos":[],"count_time":{"symbolsCount":685,"symbolsTime":"1 mins."},"categories":[{"name":"Chrome","slug":"Chrome","count":1,"path":"api/categories/Chrome.json"}],"tags":[{"name":"工具","slug":"工具","count":8,"path":"api/tags/工具.json"},{"name":"Chrome","slug":"Chrome","count":1,"path":"api/tags/Chrome.json"}],"author":{"name":"陈海龙","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"需要就学呗，多大点事😂","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"vscode插件 paste code to snippets","uid":"832da5e8309651301e718ddb27ca95fd","slug":"2022-05-11vscode","date":"2022-05-11T01:38:30.000Z","updated":"2022-06-02T10:49:11.120Z","comments":true,"path":"api/articles/2022-05-11vscode.json","keywords":null,"cover":[],"text":"粘贴代码，生成用户代码片段背景 其他插件具有共性，而不具特性 ，每次写代码，要么用第三方插件，现成的代码片段，时常不能满足日常开发需要 自定义代码片段，手写 费时费力，一般步骤，粘贴、修改、格式化 其他插件类似vscode宏变量的使用少之又少， 要么将开源插件定制化，要么重新开发...","link":"","photos":[],"count_time":{"symbolsCount":733,"symbolsTime":"1 mins."},"categories":[{"name":"vscode","slug":"vscode","count":2,"path":"api/categories/vscode.json"}],"tags":[{"name":"增效","slug":"增效","count":8,"path":"api/tags/增效.json"},{"name":"vscode","slug":"vscode","count":4,"path":"api/tags/vscode.json"}],"author":{"name":"陈海龙","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"需要就学呗，多大点事😂","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}