{"title":"ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆ","uid":"74208bc76768a419347d0ad3e15c33b0","slug":"2022-07-05wxfile","date":"2022-07-05T15:16:30.000Z","updated":"2022-07-05T16:07:40.004Z","comments":true,"path":"api/articles/2022-07-05wxfile.json","keywords":null,"cover":[],"content":"<h2 id=\"ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆ\"><a href=\"#ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆ\" class=\"headerlink\" title=\"ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆ\"></a>ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆ</h2><p><strong>è¯•é”™ 1:</strong></p>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">const fileName &#x3D; &quot;xxxxx.jpeg&quot;; &#x2F;&#x2F; ä¸¾ä¸ªä¾‹å­\ndownloadAttachment(downloadUrl).then((res) &#x3D;&gt; &#123;\n  var reader &#x3D; new FileReader();\n  reader.readAsDataURL(res); &#x2F;&#x2F; è½¬æ¢ä¸ºbase64ï¼Œå¯ä»¥ç›´æ¥æ”¾å…¥aæ ‡ç­¾href\n  reader.onload &#x3D; function (e) &#123;\n    const anchorEle &#x3D; document.createElement(&quot;a&quot;);\n    document.body.appendChild(anchorEle);\n    anchorEle.href &#x3D; e?.target?.result as any;\n    anchorEle.download &#x3D; fileName;\n    anchorEle.click();\n    setTimeout(() &#x3D;&gt; &#123;\n      document.body.removeChild(anchorEle);\n    &#125;);\n  &#125;;\n&#125;);</code></pre>\n\n<p><strong>è¯•é”™ 2: file-saver</strong></p>\n<p><strong>è¯•é”™ 3: file-saver</strong></p>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">export const downloadFile &#x3D; (target, filename &#x3D; &quot;&quot;, type &#x3D; &quot;url&quot;) &#x3D;&gt; &#123;\n  const link &#x3D; document.createElement(&quot;a&quot;);\n  const body &#x3D; document.querySelector(&quot;body&quot;);\n  if (!body) return;\n\n  &#x2F;&#x2F; éœ€ä¸‹è½½çš„æ–‡ä»¶ç±»å‹\n  if (type &#x3D;&#x3D;&#x3D; &quot;url&quot;) &#123;\n    link.href &#x3D; target;\n  &#125; else if (type &#x3D;&#x3D;&#x3D; &quot;blob&quot;) &#123;\n    link.href &#x3D; window.URL.createObjectURL(target);\n  &#125;\n\n  &#x2F;&#x2F; æ–‡ä»¶å\n  if (filename) link.download &#x3D; filename;\n\n  link.style.display &#x3D; &quot;none&quot;;\n  body.appendChild(link);\n\n  link.click();\n\n  window.URL.revokeObjectURL(link.href); &#x2F;&#x2F; é‡Šæ”¾ URL å¯¹è±¡\n  body.removeChild(link);\n&#125;;</code></pre>\n\n<p>åœ¨æµè§ˆå™¨ä¸Šæ²¡é—®é¢˜ï¼Œåœ¨ä¼ä¸šå¾®ä¿¡ä¸Š<code>å—å±ï½</code>ï¼Œæœ‰äººè¦è¯´äº†ï¼Œç›´æ¥<code>window.open(downloadUrl)</code>,é€šå¸¸æ¥è¯´æ²¡æ¯›ç—…ã€‚</p>\n<p><strong>å¯æ˜¯</strong>ï¼Œè¦åœ¨è¯·æ±‚<code>downloadUrl</code>æ¥å£æ—¶å€™è¦åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œè¿™å°¼ç›æ•´çš„ï½</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220705223754.webp\" />\n\n<h2 id=\"è¿™åœºæ™¯çœŸ-ğŸ¶\"><a href=\"#è¿™åœºæ™¯çœŸ-ğŸ¶\" class=\"headerlink\" title=\"è¿™åœºæ™¯çœŸ ğŸ¶\"></a>è¿™åœºæ™¯çœŸ ğŸ¶</h2><p>ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¥‡è‘©çš„äº‹æƒ…å‘¢ï¼Ÿâ€”â€” ç»§ä¹‹å‰ï¼Œå¯¹åŒä¸€ä¸ªåŸŸåï¼Œä»¥è¯·æ±‚å¤´åŒºåˆ†æ˜¯<strong>ä¼ä¸šå¾®ä¿¡</strong>ã€<strong>éä¼ä¸šå¾®ä¿¡</strong>ï¼Œä¸¤ç§ç¯å¢ƒçš„æˆæƒæ ¡éªŒæ–¹å¼ä¸åŒã€‚æœ¬èº«æ¶‰åŠæ²¡ä½¿ç”¨ userAgent,è®¾è®¡ç¼ºé™·ï¼Œå¯¼è‡´ä¸€è¿ä¸²é—®é¢˜ã€‚</p>\n<p>é—®ï¼š<code>ä½ æ€ä¹ˆä¸é‡æ„ï¼Ÿ</code> ç­”ï¼š<code>éƒ¨é—¨éƒ½è¢«è£äº†ï¼Œæˆ‘å†åŠªåŠ›æœ‰ç”¨å—ï¼Ÿ</code></p>\n<h2 id=\"è§£å†³æ–¹æ¡ˆ\"><a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆ\"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æ–¹æ¡ˆ 1: æŒ‰ç…§ä¹‹å‰çš„è®¾è®¡ï¼Œå†ç”³è¯·ä¸ªåŸŸåï¼ŒæŒ‰ç…§åŸŸåæŠŠåº”ç”¨æ‹†åˆ†ï¼ˆ<code>è¿™ä¸ªè¦èµ°å®¡æ ¸</code>ï¼‰</p>\n<p>æ–¹æ¡ˆ 2: åç«¯å¤„ç†ç”¨<code>userAgent</code>å¤„ç†ä¸‹ï¼Œå…¶ä»–åœ°æ–¹é€»è¾‘ä¸åŠ¨ï¼Œåªå¤„ç† a æ ‡ç­¾ä¸‹è½½çš„æƒ…å†µï¼ˆ<code>è¿™ä¸ªè¦åç«¯æ”¹---æ²¡æƒé™æˆ‘è§‰å¾—æˆ‘è‡ªå·±æ”¹æˆ–è®¸æ›´å¿«</code>ï¼‰</p>\n<p>æ–¹æ¡ˆ 3: æŠŠ API æ”¹äº†ï¼Œå“ªé‡Œå‡ºé—®é¢˜æ”¹å“ªé‡Œ <code>api/wx/download</code> ç»™è¿™ä¸ªå¢åŠ è¯·æ±‚å¤´ï¼Œ ä»£ç†åˆ° <code>api/download</code>ï¼ˆ<code>è¿™é‡Œåº”è¯¥ä¼šå¸¦è¿‡æ¥è¯·æ±‚å¤´</code>ï¼‰</p>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">let fileUrl &#x3D;\n  &quot;themis&#x2F;attach&#x2F;download?cloudKey&#x3D;&quot; +\n  attachment.themisCloudKey +\n  &quot;&amp;fileName&#x3D;&quot; +\n  encodeURIComponen(attachment.name);\n&#x2F;&#x2F; ä¼ä¸šå¾®ä¿¡\nif (getWechatUserAgent(navigator.userAgent)) &#123;\n  downloadFile(&#96;&#x2F;api&#x2F;redline&#x2F;wx&#x2F;$&#123;fileUrl&#125;&#96;);\n  &#x2F;&#x2F; éä¼ä¸šå¾®ä¿¡\n&#125; else &#123;\n  downloadFile(&#96;&#x2F;api&#x2F;redline&#x2F;$&#123;fileUrl&#125;&#96;);\n&#125;</code></pre>\n\n<img src=\"http://t-blog-images.aijs.top/img/20220706000557.webp\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/20220706000652.webp\" />\n\n<p>å“ˆå“ˆï½ï¼Œå¼€å¿ƒï½</p>\n","text":"ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆè¯•é”™ 1: const fileName &#x3D; &quot;xxxxx.jpeg&quot;; &#x2F;&#x2F; ä¸¾ä¸ªä¾‹å­ downloadAttachment(downloadUrl).then((res) &#x3D;&gt; &#123; v...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"ä¼ä¸šå¾®ä¿¡","slug":"ä¼ä¸šå¾®ä¿¡","count":2,"path":"api/categories/ä¼ä¸šå¾®ä¿¡.json"}],"tags":[{"name":"ä¼ä¸šå¾®ä¿¡","slug":"ä¼ä¸šå¾®ä¿¡","count":2,"path":"api/tags/ä¼ä¸šå¾®ä¿¡.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88\"><span class=\"toc-text\">ä¼ä¸šå¾®ä¿¡æ–‡ä»¶é¢„è§ˆ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%99%E5%9C%BA%E6%99%AF%E7%9C%9F-%F0%9F%90%B6\"><span class=\"toc-text\">è¿™åœºæ™¯çœŸ ğŸ¶</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">è§£å†³æ–¹æ¡ˆ</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"å¾…åŠäº‹é¡¹","uid":"c370dd6ecfc84fe9fdfa77b1a6f29341","slug":"todo","date":"2022-12-14T03:59:59.000Z","updated":"2022-07-04T12:44:20.221Z","comments":true,"path":"api/articles/todo.json","keywords":null,"cover":[],"text":"&#x2F;&#x2F; 1. headless-recorder &#x2F;&#x2F; 2. lightHouse https:&#x2F;&#x2F;blog.csdn.net&#x2F;tangdou369098655&#x2F;article&#x2F;details...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"Todo","slug":"Todo","count":1,"path":"api/categories/Todo.json"}],"tags":[{"name":"Todo","slug":"Todo","count":1,"path":"api/tags/Todo.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"javascript ä»£ç ","uid":"b372a96513accffd7382c09ef2a349f7","slug":"2022-07-04js","date":"2022-07-04T07:31:24.000Z","updated":"2022-07-05T10:06:23.678Z","comments":true,"path":"api/articles/2022-07-04js.json","keywords":null,"cover":[],"text":"æ’åºå†’æ³¡æ’åº é€‰æ‹©æ’åº æ’å…¥æ’åº å½’å¹¶æ’åº å¸Œå°”æ’åº å¿«é€Ÿæ’åº &#x2F;* å¿«æ’æ˜¯å†’æ³¡çš„ä¸€ç§æ”¹è¿›ï¼ŒåŸºäºåˆ†æ²»æ€æƒ³ *&#x2F; const arr2 &#x3D; [2, 44, 1, 0, -22, 56, -78]; function quickSort2(arr) &#...","link":"","photos":[],"count_time":{"symbolsCount":"8.1k","symbolsTime":"7 mins."},"categories":[{"name":"é¢è¯•","slug":"é¢è¯•","count":9,"path":"api/categories/é¢è¯•.json"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","count":6,"path":"api/tags/é¢è¯•.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}